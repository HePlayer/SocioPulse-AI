# MultiAI Agent配置功能指南

## 概述

MultiAI现在支持高级的Agent配置功能，允许用户在创建聊天室时自定义多个Agent，每个Agent都可以有独特的角色、提示词和模型配置。

## 功能特性

### 🎯 核心功能
- **多Agent支持**: 在一个聊天室中配置多个不同角色的Agent
- **自定义Prompt**: 为每个Agent设置个性化的系统提示词
- **角色模板**: 预设的专业角色模板（数学家、程序员、历史学家等）
- **模型选择**: 为不同Agent选择不同的AI模型
- **智能聊天类型**: 自动判断单聊或群聊模式

### 🎨 用户界面
- **直观的配置界面**: 点击"+"按钮打开Agent配置模态框
- **动态表单**: 根据聊天类型动态调整Agent数量限制
- **实时预览**: 配置过程中实时显示Agent信息
- **响应式设计**: 适配不同屏幕尺寸

## 使用方法

### 1. 创建新聊天室

1. 点击聊天列表上方的 **"+"** 按钮
2. 在弹出的配置对话框中填写聊天室信息：
   - **聊天室名称**: 为你的聊天室起一个有意义的名字
   - **聊天类型**: 选择"单个Agent对话"或"多Agent群聊"

### 2. 配置Agent

#### 单Agent模式
- 只能配置一个Agent
- 适合专注的一对一对话

#### 多Agent群聊模式
- 可以添加多个Agent
- Agent之间可以相互交流
- 适合复杂的多角度讨论

### 3. Agent配置选项

每个Agent可以配置以下选项：

#### 基本信息
- **Agent名称**: 给Agent起一个识别名称
- **角色类型**: 从预设模板中选择或自定义

#### 预设角色模板
- **通用助手**: 友好的通用AI助手
- **数学家**: 专业的数学问题解决专家
- **程序员**: 编程和技术开发专家
- **历史学家**: 历史知识和分析专家
- **自定义**: 完全自定义的角色

#### 高级配置
- **自定义Prompt**: 详细的角色设定和行为指令
- **模型选择**: 选择适合的AI模型（AiHubMix、OpenAI、智谱AI等）

## 配置示例

### 示例1: 学习讨论群
```json
{
  "room_name": "学习讨论群",
  "room_type": "group",
  "agents": [
    {
      "name": "数学老师",
      "role": "mathematician",
      "prompt": "你是一位耐心的数学老师，擅长用简单易懂的方式解释复杂的数学概念。",
      "model_type": "aihubmix"
    },
    {
      "name": "编程导师",
      "role": "programmer", 
      "prompt": "你是一位经验丰富的编程导师，专注于教授编程最佳实践和解决实际问题。",
      "model_type": "aihubmix"
    }
  ]
}
```

### 示例2: 专业咨询
```json
{
  "room_name": "专业咨询",
  "room_type": "single",
  "agents": [
    {
      "name": "专业顾问",
      "role": "custom",
      "prompt": "你是一位专业的商业顾问，具有丰富的行业经验，能够提供战略性建议和解决方案。",
      "model_type": "openai"
    }
  ]
}
```

## API接口

### 创建聊天室
```http
POST /api/rooms
Content-Type: application/json

{
  "room_name": "聊天室名称",
  "room_type": "single|group",
  "agents": [
    {
      "name": "Agent名称",
      "role": "角色类型",
      "prompt": "自定义提示词",
      "model_type": "模型类型"
    }
  ]
}
```

### 响应格式
```json
{
  "success": true,
  "room_id": "房间ID",
  "room_info": {
    "room_name": "聊天室名称",
    "agent_count": 2,
    "communication_mode": "network"
  },
  "message": "Successfully created group room with 2 agents"
}
```

## 技术实现

### 前端实现
- **模态框组件**: 使用CSS和JavaScript实现的配置界面
- **动态表单**: 根据用户选择动态生成Agent配置项
- **数据验证**: 前端验证确保配置的完整性和正确性

### 后端处理
- **配置解析**: 解析前端发送的Agent配置数据
- **Agent创建**: 根据配置创建具有特定角色和提示词的Agent
- **聊天室管理**: 根据Agent数量自动选择合适的通信模式

### 数据流程
1. 用户在前端配置Agent
2. 前端验证并发送配置到后端
3. 后端创建聊天室和Agent实例
4. 设置Agent的系统提示词和元数据
5. 返回创建结果给前端

## 测试

### 运行测试
```bash
# 启动服务器
python Server.py

# 运行Agent配置测试
python test_agent_config.py
```

### 测试内容
- 多Agent聊天室创建
- 单Agent聊天室创建
- Agent配置验证
- 消息发送和处理
- 聊天历史记录

## 最佳实践

### Agent设计建议
1. **明确角色定位**: 为每个Agent设定清晰的专业领域
2. **详细的Prompt**: 提供具体的行为指导和专业背景
3. **合理的数量**: 群聊中Agent数量建议2-5个，避免过于复杂
4. **互补性**: 选择能够相互补充的Agent角色

### 使用场景
- **教育讨论**: 不同学科的专家Agent协作教学
- **项目规划**: 技术、设计、管理等不同角色的Agent参与
- **创意头脑风暴**: 多个创意Agent从不同角度提供想法
- **专业咨询**: 单个专业Agent提供深度咨询服务

## 故障排除

### 常见问题
1. **Agent创建失败**: 检查Prompt长度和格式
2. **模型不可用**: 确认选择的模型已正确配置
3. **聊天室无响应**: 检查Agent是否成功添加到聊天室

### 调试方法
- 查看服务器日志获取详细错误信息
- 使用测试脚本验证API功能
- 检查浏览器控制台的JavaScript错误

## 未来计划

- [ ] Agent头像自定义
- [ ] 更多预设角色模板
- [ ] Agent性格和语言风格配置
- [ ] Agent之间的关系设定
- [ ] 批量导入/导出Agent配置
- [ ] Agent性能监控和分析

---

*最后更新: 2025年1月14日*
